using UnityEngine;

public class Enemy : MonoBehaviour
{
    [SerializeField] private float speed = 2f;

    private bool isJumping = false;

    private SpriteRenderer _spr;
    private Rigidbody2D _rb;
    private Animator _anim;

    // Start is called before the first frame update
    private void Start()
    {
        _spr = GetComponent<SpriteRenderer>();
        _rb = GetComponent<Rigidbody2D>();
        _anim = GetComponent<Animator>();
    }

    private void Update()
    {
        if(Input.GetButton("Horizontal"))
        {
            float axis = Input.GetAxis("Horizontal");
            transform.position += new Vector3(speed * Time.deltaTime * axis, 0, 0);

            /*if (axis < 0)
                _spr.flipX = true;
            else if (axis > 0)
                _spr.flipX = false;*/

            if (axis != 0) _spr.flipX = axis < 0;
        }

        if(Input.GetButtonDown("Vertical") && Input.GetAxis("Vertical") > 0 && !isJumping)
        {
            _rb.AddForce(Vector2.up * jumpForce, ForceMode2D.Impulse);
            isJumping = true;
        }

        //if (isJumping && Physics2D.OverlapBox(Vector2.zero, Vector2.one, 360)) isJumping = false;

        _anim.SetBool("Walking", Input.GetButton("Horizontal"));
        _anim.SetBool("Jumping", isJumping);
    }

    private void OnCollisionEnter2D(Collision2D collision)
    {
        if(collision.gameObject.CompareTag("Floor"))
        {
            isJumping = false;
        }
    }

    private void OnTriggerEnter2D(Collider2D collision)
    {
        if(collision.gameObject.CompareTag("Collectible"))
        {
            collectiblesAudioSource.Play();
            CollectiblesUI.instance.PickCollectible();
            Destroy(collision.gameObject);
        }
    }
}
